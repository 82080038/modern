<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fundamental Analysis - Trading Platform Modern</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        .fundamental-card { border-left: 4px solid #ffc107; }
        .ratio-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .valuation-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .growth-card { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .chart-container { height: 300px; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                üöÄ Trading Platform Modern
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#fundamental">Fundamental</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="sentiment.html">Sentiment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="screener.html">Screener</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Symbol Search -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üîç Fundamental Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="symbol-input" placeholder="Enter symbol (e.g., BBCA, BBRI, BMRI)" value="BBCA">
                                    <button class="btn btn-primary" onclick="analyzeSymbol()">Analyze</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-primary" onclick="loadSampleData('BBCA')">BBCA</button>
                                    <button class="btn btn-outline-primary" onclick="loadSampleData('BBRI')">BBRI</button>
                                    <button class="btn btn-outline-primary" onclick="loadSampleData('BMRI')">BMRI</button>
                                    <button class="btn btn-outline-primary" onclick="loadSampleData('TLKM')">TLKM</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Results -->
        <div id="analysis-results" style="display: none;">
            <!-- Company Overview -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0" id="company-name">Company Overview</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Symbol</h6>
                                        <h4 id="company-symbol">BBCA</h4>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Sector</h6>
                                        <h4 id="company-sector">Banking</h4>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Market Cap</h6>
                                        <h4 id="company-mcap">Rp 1.2T</h4>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Fundamental Score</h6>
                                        <h4 id="fundamental-score" class="text-success">85/100</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Ratios -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card ratio-card">
                        <div class="card-header">
                            <h5 class="mb-0">üìä Profitability Ratios</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-dark table-sm">
                                <thead>
                                    <tr>
                                        <th>Ratio</th>
                                        <th>Value</th>
                                        <th>Industry Avg</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="profitability-ratios">
                                    <tr>
                                        <td>ROE</td>
                                        <td id="roe-value">18.5%</td>
                                        <td>15.2%</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>ROA</td>
                                        <td id="roa-value">2.8%</td>
                                        <td>2.1%</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>Profit Margin</td>
                                        <td id="profit-margin-value">25.4%</td>
                                        <td>20.1%</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>Operating Margin</td>
                                        <td id="operating-margin-value">35.2%</td>
                                        <td>28.5%</td>
                                        <td><span class="badge bg-success">Good</span></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card ratio-card">
                        <div class="card-header">
                            <h5 class="mb-0">üíß Liquidity Ratios</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-dark table-sm">
                                <thead>
                                    <tr>
                                        <th>Ratio</th>
                                        <th>Value</th>
                                        <th>Industry Avg</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="liquidity-ratios">
                                    <tr>
                                        <td>Current Ratio</td>
                                        <td id="current-ratio-value">1.85</td>
                                        <td>1.45</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>Quick Ratio</td>
                                        <td id="quick-ratio-value">1.42</td>
                                        <td>1.15</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>Cash Ratio</td>
                                        <td id="cash-ratio-value">0.85</td>
                                        <td>0.65</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Valuation & Growth -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card valuation-card">
                        <div class="card-header">
                            <h5 class="mb-0">üí∞ Valuation Metrics</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-dark table-sm">
                                <thead>
                                    <tr>
                                        <th>Metric</th>
                                        <th>Value</th>
                                        <th>Industry Avg</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="valuation-metrics">
                                    <tr>
                                        <td>P/E Ratio</td>
                                        <td id="pe-ratio-value">12.5</td>
                                        <td>15.8</td>
                                        <td><span class="badge bg-success">Undervalued</span></td>
                                    </tr>
                                    <tr>
                                        <td>P/B Ratio</td>
                                        <td id="pb-ratio-value">2.1</td>
                                        <td>2.8</td>
                                        <td><span class="badge bg-success">Undervalued</span></td>
                                    </tr>
                                    <tr>
                                        <td>PEG Ratio</td>
                                        <td id="peg-ratio-value">0.85</td>
                                        <td>1.2</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>EV/EBITDA</td>
                                        <td id="ev-ebitda-value">8.5</td>
                                        <td>12.1</td>
                                        <td><span class="badge bg-success">Undervalued</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card growth-card">
                        <div class="card-header">
                            <h5 class="mb-0">üìà Growth Metrics</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-dark table-sm">
                                <thead>
                                    <tr>
                                        <th>Metric</th>
                                        <th>Value</th>
                                        <th>Industry Avg</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="growth-metrics">
                                    <tr>
                                        <td>EPS Growth (YoY)</td>
                                        <td id="eps-growth-value">15.2%</td>
                                        <td>8.5%</td>
                                        <td><span class="badge bg-success">Strong</span></td>
                                    </tr>
                                    <tr>
                                        <td>Revenue Growth (YoY)</td>
                                        <td id="revenue-growth-value">12.8%</td>
                                        <td>6.2%</td>
                                        <td><span class="badge bg-success">Strong</span></td>
                                    </tr>
                                    <tr>
                                        <td>Book Value Growth</td>
                                        <td id="book-value-growth-value">18.5%</td>
                                        <td>10.1%</td>
                                        <td><span class="badge bg-success">Strong</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DCF Valuation -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">üéØ DCF Valuation</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Intrinsic Value</h6>
                                        <h4 id="intrinsic-value" class="text-success">Rp 9,250</h4>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Current Price</h6>
                                        <h4 id="current-price">Rp 8,500</h4>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Margin of Safety</h6>
                                        <h4 id="margin-of-safety" class="text-success">8.8%</h4>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <h6 class="text-muted">Upside Potential</h6>
                                        <h4 id="upside-potential" class="text-success">8.8%</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Graham Number -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">üìê Graham Number Analysis</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h6 class="text-muted">Graham Number</h6>
                                        <h4 id="graham-number" class="text-info">Rp 7,850</h4>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h6 class="text-muted">EPS</h6>
                                        <h4 id="eps-value">Rp 680</h4>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h6 class="text-muted">Book Value per Share</h6>
                                        <h4 id="book-value-per-share">Rp 4,050</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Peer Comparison -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">üè¢ Peer Comparison</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="peer-comparison-table">
                                    <thead>
                                        <tr>
                                            <th>Company</th>
                                            <th>P/E Ratio</th>
                                            <th>P/B Ratio</th>
                                            <th>ROE</th>
                                            <th>ROA</th>
                                            <th>Debt/Equity</th>
                                            <th>Current Ratio</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-primary">
                                            <td><strong>BBCA (Current)</strong></td>
                                            <td><strong>12.5</strong></td>
                                            <td><strong>2.1</strong></td>
                                            <td><strong>18.5%</strong></td>
                                            <td><strong>2.8%</strong></td>
                                            <td><strong>0.85</strong></td>
                                            <td><strong>1.85</strong></td>
                                        </tr>
                                        <tr>
                                            <td>BBRI</td>
                                            <td>14.2</td>
                                            <td>1.8</td>
                                            <td>16.2%</td>
                                            <td>2.1%</td>
                                            <td>0.95</td>
                                            <td>1.65</td>
                                        </tr>
                                        <tr>
                                            <td>BMRI</td>
                                            <td>13.8</td>
                                            <td>1.9</td>
                                            <td>15.8%</td>
                                            <td>2.2%</td>
                                            <td>0.88</td>
                                            <td>1.72</td>
                                        </tr>
                                        <tr>
                                            <td>BNII</td>
                                            <td>16.5</td>
                                            <td>2.3</td>
                                            <td>14.1%</td>
                                            <td>1.9%</td>
                                            <td>1.05</td>
                                            <td>1.58</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="text-center" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Analyzing fundamental data...</p>
        </div>

        <!-- Error State -->
        <div id="error-state" class="alert alert-danger" style="display: none;">
            <h4 class="alert-heading">Analysis Error</h4>
            <p id="error-message">Unable to load fundamental data for the selected symbol.</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let currentSymbol = 'BBCA';

        // Initialize page
        $(document).ready(function() {
            // Initialize DataTable
            $('#peer-comparison-table').DataTable({
                paging: false,
                searching: false,
                info: false
            });
        });

        function analyzeSymbol() {
            const symbol = $('#symbol-input').val().toUpperCase();
            if (!symbol) {
                alert('Please enter a symbol');
                return;
            }
            
            currentSymbol = symbol;
            loadFundamentalData(symbol);
        }

        function loadSampleData(symbol) {
            $('#symbol-input').val(symbol);
            currentSymbol = symbol;
            loadFundamentalData(symbol);
        }

        function loadFundamentalData(symbol) {
            // Show loading state
            $('#loading-state').show();
            $('#analysis-results').hide();
            $('#error-state').hide();

            // Load financial ratios
            $.ajax({
                url: API_BASE + '/fundamental/ratios/' + symbol,
                method: 'GET',
                success: function(data) {
                    updateFundamentalData(data);
                    $('#loading-state').hide();
                    $('#analysis-results').show();
                },
                error: function(xhr) {
                    console.error('Error loading fundamental data:', xhr);
                    $('#loading-state').hide();
                    $('#error-state').show();
                    $('#error-message').text('Error loading data for ' + symbol + ': ' + xhr.responseText);
                }
            });

            // Load DCF valuation
            $.ajax({
                url: API_BASE + '/fundamental/dcf/' + symbol + '?current_price=8500',
                method: 'GET',
                success: function(data) {
                    updateDCFData(data);
                },
                error: function(xhr) {
                    console.error('Error loading DCF data:', xhr);
                }
            });

            // Load Graham Number
            $.ajax({
                url: API_BASE + '/fundamental/graham/' + symbol,
                method: 'GET',
                success: function(data) {
                    updateGrahamData(data);
                },
                error: function(xhr) {
                    console.error('Error loading Graham data:', xhr);
                }
            });

            // Load fundamental score
            $.ajax({
                url: API_BASE + '/fundamental/score/' + symbol,
                method: 'GET',
                success: function(data) {
                    updateScoreData(data);
                },
                error: function(xhr) {
                    console.error('Error loading score data:', xhr);
                }
            });
        }

        function updateFundamentalData(data) {
            // Update company info
            $('#company-symbol').text(currentSymbol);
            $('#company-name').text(currentSymbol + ' - Fundamental Analysis');
            
            // Update profitability ratios
            if (data.profitability) {
                if (data.profitability.roe) $('#roe-value').text(data.profitability.roe.toFixed(1) + '%');
                if (data.profitability.roa) $('#roa-value').text(data.profitability.roa.toFixed(1) + '%');
                if (data.profitability.profit_margin) $('#profit-margin-value').text(data.profitability.profit_margin.toFixed(1) + '%');
                if (data.profitability.operating_margin) $('#operating-margin-value').text(data.profitability.operating_margin.toFixed(1) + '%');
            }

            // Update liquidity ratios
            if (data.liquidity) {
                if (data.liquidity.current_ratio) $('#current-ratio-value').text(data.liquidity.current_ratio.toFixed(2));
                if (data.liquidity.cash_ratio) $('#cash-ratio-value').text(data.liquidity.cash_ratio.toFixed(2));
            }

            // Update valuation metrics
            if (data.valuation) {
                if (data.valuation.pe_ratio) $('#pe-ratio-value').text(data.valuation.pe_ratio.toFixed(1));
                if (data.valuation.pb_ratio) $('#pb-ratio-value').text(data.valuation.pb_ratio.toFixed(1));
                if (data.valuation.peg_ratio) $('#peg-ratio-value').text(data.valuation.peg_ratio.toFixed(2));
                if (data.valuation.ev_ebitda) $('#ev-ebitda-value').text(data.valuation.ev_ebitda.toFixed(1));
            }
        }

        function updateDCFData(data) {
            if (data.intrinsic_value) $('#intrinsic-value').text('Rp ' + data.intrinsic_value.toLocaleString());
            if (data.current_price) $('#current-price').text('Rp ' + data.current_price.toLocaleString());
            if (data.margin_of_safety) {
                const margin = (data.margin_of_safety * 100).toFixed(1);
                $('#margin-of-safety').text(margin + '%');
                $('#margin-of-safety').removeClass('text-success text-danger').addClass(margin > 0 ? 'text-success' : 'text-danger');
            }
            if (data.upside_potential) {
                const upside = (data.upside_potential * 100).toFixed(1);
                $('#upside-potential').text(upside + '%');
                $('#upside-potential').removeClass('text-success text-danger').addClass(upside > 0 ? 'text-success' : 'text-danger');
            }
        }

        function updateGrahamData(data) {
            if (data.graham_number) $('#graham-number').text('Rp ' + data.graham_number.toLocaleString());
            if (data.eps) $('#eps-value').text('Rp ' + data.eps.toLocaleString());
            if (data.book_value_per_share) $('#book-value-per-share').text('Rp ' + data.book_value_per_share.toLocaleString());
        }

        function updateScoreData(data) {
            if (data.fundamental_score) {
                $('#fundamental-score').text(data.fundamental_score.toFixed(0) + '/100');
                $('#fundamental-score').removeClass('text-success text-warning text-danger');
                if (data.fundamental_score >= 80) {
                    $('#fundamental-score').addClass('text-success');
                } else if (data.fundamental_score >= 60) {
                    $('#fundamental-score').addClass('text-warning');
                } else {
                    $('#fundamental-score').addClass('text-danger');
                }
            }
        }
    </script>
</body>
</html>
