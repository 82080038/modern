<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI/ML Models - Trading Platform Modern</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .ai-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .model-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        .model-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .signal-card {
            border-left: 4px solid #28a745;
            background: #f8f9fa;
        }
        .signal-buy {
            border-left-color: #28a745;
        }
        .signal-sell {
            border-left-color: #dc3545;
        }
        .signal-hold {
            border-left-color: #ffc107;
        }
        .confidence-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            transition: width 0.3s ease;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-robot me-2"></i>Trading Platform Modern
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="fundamental.html">Fundamental</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="technical.html">Technical</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="sentiment.html">Sentiment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="ai-ml.html">AI/ML</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="trading.html">Trading</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h2><i class="fas fa-robot me-2"></i>AI/ML Models</h2>
                <p class="text-muted">Advanced machine learning models for pattern recognition, sentiment analysis, and predictive analytics</p>
            </div>
        </div>

        <!-- AI Dashboard Summary -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="ai-card">
                    <h5><i class="fas fa-brain me-2"></i>Pattern Recognition</h5>
                    <div class="metric-value" id="patternAccuracy">-</div>
                    <small>Accuracy Rate</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="ai-card">
                    <h5><i class="fas fa-chart-line me-2"></i>Gap Analysis</h5>
                    <div class="metric-value" id="gapAccuracy">-</div>
                    <small>Detection Rate</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="ai-card">
                    <h5><i class="fas fa-book me-2"></i>Order Book</h5>
                    <div class="metric-value" id="orderBookEfficiency">-</div>
                    <small>Efficiency Score</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="ai-card">
                    <h5><i class="fas fa-arrows-alt me-2"></i>Mean Reversion</h5>
                    <div class="metric-value" id="meanReversionScore">-</div>
                    <small>Effectiveness</small>
                </div>
            </div>
        </div>

        <!-- Symbol Selection -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="symbolInput" placeholder="Enter symbol (e.g., BBCA.JK)" value="BBCA.JK">
                    <button class="btn btn-primary" onclick="loadAIData()">
                        <i class="fas fa-robot me-1"></i>Analyze
                    </button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-primary active" onclick="setAnalysisType('pattern')">Pattern</button>
                    <button class="btn btn-outline-primary" onclick="setAnalysisType('signals')">Signals</button>
                    <button class="btn btn-outline-primary" onclick="setAnalysisType('predictions')">Predictions</button>
                    <button class="btn btn-outline-primary" onclick="setAnalysisType('performance')">Performance</button>
                </div>
            </div>
        </div>

        <!-- AI Analysis Results -->
        <div class="row" id="aiResults" style="display: none;">
            <!-- Pattern Analysis -->
            <div class="col-lg-6" id="patternAnalysis">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-shapes me-2"></i>Pattern Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div id="patternChart" class="chart-container"></div>
                        <div id="patternDetails">
                            <!-- Pattern details will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Signals -->
            <div class="col-lg-6" id="aiSignals">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-signal me-2"></i>AI Trading Signals</h5>
                    </div>
                    <div class="card-body">
                        <div id="signalsList">
                            <!-- Signals will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ML Predictions -->
        <div class="row mt-4" id="mlPredictions" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-crystal-ball me-2"></i>ML Predictions</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="predictionsList">
                            <!-- Predictions will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Performance -->
        <div class="row mt-4" id="modelPerformance" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-tachometer-alt me-2"></i>Model Performance</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="performanceMetrics">
                            <!-- Performance metrics will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Dashboard -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-dashboard me-2"></i>AI Dashboard</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="aiDashboard">
                            <!-- Dashboard data will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentSymbol = 'BBCA.JK';
        let currentAnalysisType = 'pattern';

        // Load AI data
        async function loadAIData() {
            const symbol = document.getElementById('symbolInput').value.trim();
            if (!symbol) {
                alert('Please enter a symbol');
                return;
            }

            currentSymbol = symbol;
            showLoading();

            try {
                // Load AI dashboard
                const dashboardResponse = await fetch('/api/v1/ai-ml/dashboard');
                if (dashboardResponse.ok) {
                    const dashboard = await dashboardResponse.json();
                    displayAIDashboard(dashboard);
                }

                // Load specific analysis based on type
                switch (currentAnalysisType) {
                    case 'pattern':
                        await loadPatternAnalysis(symbol);
                        break;
                    case 'signals':
                        await loadAISignals(symbol);
                        break;
                    case 'predictions':
                        await loadMLPredictions(symbol);
                        break;
                    case 'performance':
                        await loadModelPerformance(symbol);
                        break;
                }

                document.getElementById('aiResults').style.display = 'block';
            } catch (error) {
                console.error('Error loading AI data:', error);
                alert('Error loading AI data. Please try again.');
            }
        }

        // Load pattern analysis
        async function loadPatternAnalysis(symbol) {
            try {
                const response = await fetch(`/api/v1/ai-ml/pattern-analysis/${symbol}?limit=1`);
                if (response.ok) {
                    const data = await response.json();
                    displayPatternAnalysis(data);
                }
            } catch (error) {
                console.error('Error loading pattern analysis:', error);
            }
        }

        // Load AI signals
        async function loadAISignals(symbol) {
            try {
                const response = await fetch(`/api/v1/ai-ml/signals/${symbol}?limit=5`);
                if (response.ok) {
                    const data = await response.json();
                    displayAISignals(data);
                }
            } catch (error) {
                console.error('Error loading AI signals:', error);
            }
        }

        // Load ML predictions
        async function loadMLPredictions(symbol) {
            try {
                const response = await fetch(`/api/v1/ai-ml/predictions/${symbol}?limit=5`);
                if (response.ok) {
                    const data = await response.json();
                    displayMLPredictions(data);
                }
            } catch (error) {
                console.error('Error loading ML predictions:', error);
            }
        }

        // Load model performance
        async function loadModelPerformance(symbol) {
            try {
                const response = await fetch(`/api/v1/ai-ml/performance/${symbol}?limit=5`);
                if (response.ok) {
                    const data = await response.json();
                    displayModelPerformance(data);
                }
            } catch (error) {
                console.error('Error loading model performance:', error);
            }
        }

        // Display AI dashboard
        function displayAIDashboard(data) {
            // Update summary cards
            if (data.latest_signals && data.latest_signals.length > 0) {
                const signal = data.latest_signals[0];
                document.getElementById('patternAccuracy').textContent = (signal.confidence_score * 100).toFixed(1) + '%';
            }

            if (data.latest_predictions && data.latest_predictions.length > 0) {
                const prediction = data.latest_predictions[0];
                document.getElementById('gapAccuracy').textContent = (prediction.confidence * 100).toFixed(1) + '%';
            }

            if (data.performance_summary && data.performance_summary.length > 0) {
                const performance = data.performance_summary[0];
                document.getElementById('orderBookEfficiency').textContent = (performance.avg_effectiveness * 100).toFixed(1) + '%';
                document.getElementById('meanReversionScore').textContent = (performance.avg_accuracy * 100).toFixed(1) + '%';
            }

            // Display dashboard data
            const dashboard = document.getElementById('aiDashboard');
            dashboard.innerHTML = `
                <div class="col-md-6">
                    <h6>Latest Signals</h6>
                    <div class="list-group">
                        ${data.latest_signals ? data.latest_signals.slice(0, 3).map(signal => `
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <span>${signal.symbol}</span>
                                    <span class="badge bg-${signal.signal_type === 'BUY' ? 'success' : signal.signal_type === 'SELL' ? 'danger' : 'warning'}">${signal.signal_type}</span>
                                </div>
                                <small class="text-muted">Confidence: ${(signal.confidence_score * 100).toFixed(1)}%</small>
                            </div>
                        `).join('') : '<p class="text-muted">No signals available</p>'}
                    </div>
                </div>
                <div class="col-md-6">
                    <h6>Latest Predictions</h6>
                    <div class="list-group">
                        ${data.latest_predictions ? data.latest_predictions.slice(0, 3).map(prediction => `
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <span>${prediction.symbol}</span>
                                    <span class="badge bg-info">${prediction.model_type}</span>
                                </div>
                                <small class="text-muted">Price: ${prediction.predicted_price ? prediction.predicted_price.toFixed(2) : 'N/A'}</small>
                            </div>
                        `).join('') : '<p class="text-muted">No predictions available</p>'}
                    </div>
                </div>
            `;
        }

        // Display pattern analysis
        function displayPatternAnalysis(data) {
            const patternDetails = document.getElementById('patternDetails');
            
            if (data.analyses && data.analyses.length > 0) {
                const analysis = data.analyses[0];
                
                patternDetails.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <div class="model-card">
                                <h6>Pattern Strength</h6>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${(analysis.pattern_strength * 100).toFixed(1)}%"></div>
                                </div>
                                <small>${(analysis.pattern_strength * 100).toFixed(1)}%</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="model-card">
                                <h6>Gap Accuracy</h6>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${(analysis.gap_accuracy * 100).toFixed(1)}%"></div>
                                </div>
                                <small>${(analysis.gap_accuracy * 100).toFixed(1)}%</small>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="model-card">
                                <h6>Order Book Efficiency</h6>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${(analysis.order_book_efficiency * 100).toFixed(1)}%"></div>
                                </div>
                                <small>${(analysis.order_book_efficiency * 100).toFixed(1)}%</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="model-card">
                                <h6>Overall Effectiveness</h6>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${(analysis.overall_effectiveness * 100).toFixed(1)}%"></div>
                                </div>
                                <small>${(analysis.overall_effectiveness * 100).toFixed(1)}%</small>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Display AI signals
        function displayAISignals(data) {
            const signalsList = document.getElementById('signalsList');
            
            if (data.signals && data.signals.length > 0) {
                signalsList.innerHTML = data.signals.map(signal => `
                    <div class="card signal-card signal-${signal.signal_type.toLowerCase()} mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title">${signal.symbol}</h6>
                                    <p class="card-text">${signal.signal_reasoning || 'AI-generated signal'}</p>
                                </div>
                                <div class="text-end">
                                    <span class="badge bg-${signal.signal_type === 'BUY' ? 'success' : signal.signal_type === 'SELL' ? 'danger' : 'warning'} fs-6">${signal.signal_type}</span>
                                    <div class="mt-2">
                                        <small class="text-muted">Confidence: ${(signal.confidence_score * 100).toFixed(1)}%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                signalsList.innerHTML = '<p class="text-muted">No AI signals available for this symbol</p>';
            }
        }

        // Display ML predictions
        function displayMLPredictions(data) {
            const predictionsList = document.getElementById('predictionsList');
            
            if (data.predictions && data.predictions.length > 0) {
                predictionsList.innerHTML = data.predictions.map(prediction => `
                    <div class="col-md-4">
                        <div class="model-card">
                            <h6>${prediction.model_type}</h6>
                            <div class="metric-value">${prediction.predicted_price ? prediction.predicted_price.toFixed(2) : 'N/A'}</div>
                            <small class="text-muted">Predicted Price</small>
                            <div class="mt-2">
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${(prediction.confidence * 100).toFixed(1)}%"></div>
                                </div>
                                <small>Confidence: ${(prediction.confidence * 100).toFixed(1)}%</small>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                predictionsList.innerHTML = '<p class="text-muted">No ML predictions available for this symbol</p>';
            }
        }

        // Display model performance
        function displayModelPerformance(data) {
            const performanceMetrics = document.getElementById('performanceMetrics');
            
            if (data.performances && data.performances.length > 0) {
                performanceMetrics.innerHTML = data.performances.map(performance => `
                    <div class="col-md-4">
                        <div class="model-card">
                            <h6>${performance.module_name}</h6>
                            <div class="row">
                                <div class="col-6">
                                    <small>Effectiveness</small>
                                    <div class="metric-value">${(performance.effectiveness_score * 100).toFixed(1)}%</div>
                                </div>
                                <div class="col-6">
                                    <small>Accuracy</small>
                                    <div class="metric-value">${(performance.accuracy_score * 100).toFixed(1)}%</div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-6">
                                    <small>F1 Score</small>
                                    <div class="metric-value">${(performance.f1_score * 100).toFixed(1)}%</div>
                                </div>
                                <div class="col-6">
                                    <small>Processing Time</small>
                                    <div class="metric-value">${performance.processing_time_ms}ms</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                performanceMetrics.innerHTML = '<p class="text-muted">No performance data available for this symbol</p>';
            }
        }

        // Set analysis type
        function setAnalysisType(type) {
            currentAnalysisType = type;
            
            // Remove active class from all buttons
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Show/hide relevant sections
            document.getElementById('patternAnalysis').style.display = type === 'pattern' ? 'block' : 'none';
            document.getElementById('aiSignals').style.display = type === 'signals' ? 'block' : 'none';
            document.getElementById('mlPredictions').style.display = type === 'predictions' ? 'block' : 'none';
            document.getElementById('modelPerformance').style.display = type === 'performance' ? 'block' : 'none';
            
            // Reload data
            loadAIData();
        }

        // Show loading state
        function showLoading() {
            document.getElementById('aiResults').style.display = 'none';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAIData();
        });
    </script>
</body>
</html>
